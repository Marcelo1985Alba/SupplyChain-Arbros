@page "/usuarios"
@using System.IO
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Navigations
@using Syncfusion.Blazor.Calendars
@inherits CuentasUsuariosBase
@attribute [Authorize]



<div class="col-lg-12 control-section">
    <SfSpinner @ref="SpinnerObj" Label="Cargando..." Type="SpinnerType.Bootstrap" Size="80"></SfSpinner>
    <div class="content-wrapper">
        @*<div class="form-row">
                <SfButton OnClick="@(() => Grid.SetPersistData(_state))">Set State</SfButton>
                <SfButton OnClick="@(() => Grid.ResetPersistData())">Reset State</SfButton>
                <ComboVistasGrilla AppName="IdGrid"/>
                <SfButton OnClick="@(async () => _state = await Grid.GetPersistData())">Guardar Vista</SfButton>
            </div>*@
        <div class="row">
            <div class="col-3">

            </div>
        </div>
        <div class="row">
            @if (lUsuarios is not null)
            {
                <SfGrid AllowReordering="true" ShowColumnChooser="true" ShowColumnMenu="true" AllowResizing="true"
                        EnablePersistence="false" DataSource="@lUsuarios"
                        ID="gridCuentasUsuarios" Height="100%" Width="100%" GridLines="GridLine.Both" RowHeight="20"
                        @ref="GridUsu" AllowExcelExport="true" AllowRowDragAndDrop="true"
                        AllowGrouping="true" AllowMultiSorting="true"
                        AllowSorting="true" AllowPaging="true" AllowFiltering="true">
                    <GridSelectionSettings Type="Syncfusion.Blazor.Grids.SelectionType.Single"></GridSelectionSettings>

                    @*<GridEvents OnLoad="OnLoad" DataBound="DataBound" OnToolbarClick="@ClickHandler"
                                OnActionBegin="ActionBegin" TValue="Service"></GridEvents>*@
                    <GridFilterSettings Type="@Syncfusion.Blazor.Grids.FilterType.CheckBox"></GridFilterSettings>
                    <GridGroupSettings ShowGroupedColumn="true"></GridGroupSettings>
                    <GridEditSettings AllowAdding="true" AllowEditing="true" AllowDeleting="true"
                                      Mode="@EditMode.Dialog">
                        <Template>
                            @{
                                usuario = (context as Usuarios);

                        <div class="form-row">
                            <div class="form-group col-3">
                                <label class="">Nombre Usuario:</label>
                                <br />
                                <SfTextBox @bind-Value="usuario.Usuario" ShowClearButton="true"></SfTextBox>
                            </div>

                            <div class="form-group col-3">
                                <label class="">Email:</label>
                                <br />
                                <SfTextBox @bind-Value="usuario.Email" ShowClearButton="true"></SfTextBox>
                            </div>

                            <div class="form-group col-md-6">
                                <div class="form-row">
                                    <div class="col-10">
                                        <label class="">Roles:</label>
                                        <br />
                                        <SfDropDownList TItem="Rol"
                                                        TValue="string" ID="Id" DataSource="@lRoles">
                                            <DropDownListFieldSettings Text="Descripcion" Value="Id">
                                            
                                            </DropDownListFieldSettings>
                                            <DropDownListEvents TItem="Rol" TValue="string" OnValueSelect="@(async(a)=> await OnSelected(a))">

                                            </DropDownListEvents>
                                        </SfDropDownList>
                                    </div>
                                    <div class="col-2 mt-4">
                                        <Syncfusion.Blazor.Buttons.SfButton Content="Agregar Rol" IconCss="fa fa-plus"
                                                                            OnClick="@(async()=>await AsignarRol())"/>
                                    </div>
                                </div>

                            </div>
                        </div>                                

                                <SfGrid @ref="GridRolesUsuarios" DataSource="usuario.Roles">

                                </SfGrid>
                            }
                        </Template>
                    </GridEditSettings>

                    <GridColumns>
                        <GridColumn Field=@nameof(Usuarios.Usuario) HeaderText="Nombre Usuario" AllowSearching="true"
                                    TextAlign="TextAlign.Left" IsPrimaryKey="false" Width="90"></GridColumn>
                        <GridColumn Field=@nameof(Usuarios.Email) HeaderText="Correo Electronico" AllowSearching="true"
                                    TextAlign="TextAlign.Left" IsPrimaryKey="false" Width="90"></GridColumn>

                    </GridColumns>
                </SfGrid>
            }

        </div>
    </div>
</div>

